sudo: required
language: java
jdk:
  - openjdk11
services:
  - docker
cache:
  directories:
    - $HOME/.m2
    - $HOME/.npm
env:
  global:
    # AWS_ACCESS_KEY_ID
    - secure: "Nbx6ARVe/lsd1G+IT8Fsr78vEnHlo5iE8lGYP3IzsRXzhvqdA22Vk549DdiOOIiN5Vxn7uuKA60SCUqopY9Oycmk+MXgGTj5jKoivy+e6ar89QTPELGzgO2DbUtYekWCrwJ/QpEDYu1JQGte4owoE/WnvCWmV6oPHL3d7HvgKAzHOQRd09wLDN/fgRZn/rjpPgLqkDiAgkSud5oPkKyha1GyylyWvoB1aMqdeHg0ConAcPq57s8qOwcZ7lXN5RRa8H7FUqskd2kWESw6ZbYLwGC8hKiqnJiByUbJ7PFIg+9eOwtmamm2F6O7W4lzBQ7Iarthf4X7oszR5rFllF2Q79ZqqZrpNqvjCjK/C2m3MLth/MeCAjZQy2Nmsa/TNGxHhQzswvrWEKNCDSi5PynSj38W6NafvFNquI9XnWtx2y/7YY3sjmSj5VRcNqdCdaIs+c98GZrBv6dmYvPAfDjQyw9RUd45tKd8cEYemAiVS05RhxC5YxL+ZJuAjER0iejvlDxyEBIA93hNCxytCYKO1B0lDI7naFv1GpqT2p8Bdzfhxw87ZZrzkdSQz5ZxTBjOXb7+niKMMruRgZ7WmHJsAysUt45DIAkNBuH+ZUedqhOEeUs9+LxeHG5iUnoHSgqA9VxTO99l+Ecc5sC81FrU8J2QsPKg1KhnU//foIckoAw="
    # AWS_SECRET_ACCESS_KEY
    - secure: "dl6NApkYGbzpDnUmRykeBziB7uO12ZJ/z1ToT1YF9v+iwXY4A5NigQJ67A4AmtqhDJejj67/3pbwWeqk2VW4Xt2+XkEPZrwnEuJLB3Z9Ul3mmrgKlulC75wRbB/yZ8BfHl58DL85hF9oLl3WgOYTgMYhtK4q9np/hiUzi4+DW7teHJnTVYSCphwfavGxUNCMVzwVCBUiq64Wj8DrbSRgp/1VNUyHcmei2HFKmW8poonm3bqMT9ICAhPl/c00YFQ0HnG2BxrWooW/CXK6cRXAbS+JdUQF0ylT3RlZk5JWw3Qsw7IKOmuTLZFOOxblSX9xMtucW27RoNkQdM9culbtlscloJ0jggPvC7MF5TbxBZuW9jI0UqfbZNHieR0xVMRWWuaVDqlA4HolQvCnWlA6x10yuZZtBiJDBxgen72pJo0TZaRl8EBHaCY/FuA/9j2uEDU0hht8n4loHGd/pbMwfEmgq6k2d00+UG+/GLherggrZYDDiJWBz7HH8ffwgfOfjNSp3Dx4QxgTxjg/ubYz3VvY9LuMzNda4Sm7ZPTwXTYL353zAu4gofWUWQ+dMWo5tfSC1Le4YQyiYe2Qbi6azydy/mLW7yxVURsltR3DwYSR76TbTmH7IIBSpx1avbX9GzCUo2/OcrSoB6aIQB/a+cWwoeJZjlXIbPNdQi67aZQ="

install:
  - git clone https://github.com/Opetushallitus/ci-tools.git
  - source ci-tools/common/setup-tools.sh
  - export ARTIFACT_NAME="henkilo-ui"

script:
  - mvn clean install -B -Dbranch=${TRAVIS_BRANCH} -Drevision=${TRAVIS_COMMIT} -DbuildNumber=${TRAVIS_BUILD_NUMBER}

  - mv target/henkiloui-*.jar $DOCKER_BUILD_DIR/artifact/${ARTIFACT_NAME}.jar
  - cp -vr src/main/resources/oph-configuration $DOCKER_BUILD_DIR/config/

  - export BASE_IMAGE="baseimage-fatjar-openjdk11:master"
  - ./ci-tools/common/pull-image.sh
  - ./ci-tools/build/build-fatjar.sh $ARTIFACT_NAME

deploy:
  - provider: script
    script: ./ci-tools/build/upload-image.sh $ARTIFACT_NAME
    on:
      all_branches: true
